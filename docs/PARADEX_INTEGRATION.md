# Paradex Integration Guide

This guide explains how to set up and use the Paradex perpetual futures trading integration with FlashScalper.

## Overview

The Paradex integration provides:
- **Live WebSocket streaming** for real-time market data
- **Perpetual futures trading** on Paradex testnet/mainnet
- **Live stream display** for monitoring trading activity
- **Full integration** with FlashScalper's technical analysis and signal generation
- **Position management** with stop-loss, take-profit, and trailing stops

## Prerequisites

1. **Paradex Account**: Create an account on [Paradex](https://trade.paradex.trade/)
2. **API Credentials**: Generate API credentials from your Paradex account
3. **JWT Token**: Obtain a JWT token for WebSocket authentication
4. **Private Key**: Your Ethereum private key for signing transactions
5. **Node.js**: Version 18.0.0 or higher

## Configuration

### Environment Variables

Add the following variables to your `.env` file:

```bash
# Paradex Configuration
PARADEX_ACCOUNT_ADDRESS=0x...                    # Your Ethereum address
PARADEX_PRIVATE_KEY=0x...                        # Your private key (keep secure!)
PARADEX_JWT=eyJ...                               # JWT token from Paradex
PARADEX_API_KEY=your_api_key                     # (Optional) API key
PARADEX_MARKETS=BTC-USD-PERP,ETH-USD-PERP        # Comma-separated list of markets

# Paradex URLs (Optional - defaults to testnet)
PARADEX_REST_URL=https://api.testnet.paradex.trade/v1
PARADEX_WS_URL=wss://ws.api.testnet.paradex.trade/v1

# Trading Configuration (uses standard FlashScalper config)
SCALPER_LEVERAGE=10
SCALPER_POSITION_SIZE_PERCENT=25
SCALPER_MAX_POSITIONS=5
SCALPER_TAKE_PROFIT_ROE=2.0
SCALPER_STOP_LOSS_ROE=-0.5
SCALPER_MAX_HOLD_TIME_MINUTES=60

# Live Stream Display
DISPLAY_INTERVAL_MS=5000          # How often to update the display (ms)
CLEAR_CONSOLE=true                # Clear console on each update
```

### Obtaining API Credentials

1. **Login to Paradex**: Go to [trade.paradex.trade](https://trade.paradex.trade/)
2. **Navigate to API Settings**: Account ‚Üí API Settings
3. **Generate API Key**: Click "Create New API Key"
4. **Save Credentials**: Securely store your API key and secret
5. **Get JWT Token**: Use the REST API to authenticate and get a JWT token

#### Getting JWT Token

You can obtain a JWT token using the REST API:

```bash
curl -X POST https://api.testnet.paradex.trade/v1/auth/jwt \
  -H "Content-Type: application/json" \
  -d '{
    "account": "0x...",
    "timestamp": '$(date +%s000)',
    "signature": "..."
  }'
```

The signature should be generated by signing the message `paradex-auth:{account}:{timestamp}` with your private key.

## Usage

### Quick Start

1. **Install Dependencies**:
   ```bash
   npm install
   ```

2. **Configure Environment**:
   ```bash
   cp .env.example .env
   # Edit .env with your Paradex credentials
   ```

3. **Build the Project**:
   ```bash
   npm run build
   ```

4. **Run Paradex Agent**:
   ```bash
   # Development mode (with hot reload)
   npm run start:paradex

   # Production mode
   npm run start:paradex-prod
   ```

### Live Stream Display

The agent provides a live console display that updates every few seconds showing:
- Current equity and P&L
- Win rate and trade statistics
- Open positions with real-time P&L
- Market prices and updates

Example output:

```
================================================================================
üöÄ PARADEX LIVE TRADING STREAM
================================================================================

üìä AGENT STATUS: RUNNING
üí∞ Equity: $1,234.56
üìà Daily P&L: $45.23 (3.67%)
üíµ Total P&L: $123.45
üéØ Win Rate: 65.2% (15/23)
üìç Positions: 2 open
‚è±Ô∏è  Tick: #156

--------------------------------------------------------------------------------
üìå OPEN POSITIONS:
--------------------------------------------------------------------------------

üìà BTC-USD-PERP
  Side: LONG
  Size: 0.0125
  Entry: $42,150.00
  Current: $42,380.50
  ‚úÖ P&L: $2.88 (1.54% ROE)
  Leverage: 10x
  Hold Time: 12.3 min

üìâ ETH-USD-PERP
  Side: SHORT
  Size: 0.5000
  Entry: $2,245.80
  Current: $2,238.90
  ‚úÖ P&L: $3.45 (1.23% ROE)
  Leverage: 10x
  Hold Time: 8.7 min

================================================================================
Last Update: 10:30:45 PM
================================================================================
```

### Integration with Streaming Platforms

The live display can be captured and streamed to platforms like:
- **OBS Studio**: Capture terminal window as a source
- **Twitch/YouTube**: Stream the terminal output
- **Discord Bots**: Forward updates to Discord channels
- **Telegram Bots**: Send position updates to Telegram

## Architecture

### Components

1. **ParadexRestClient** (`src/services/paradex/rest-client.ts`)
   - Handles HTTP requests to Paradex REST API
   - Authentication and JWT token management
   - Account, position, and order management
   - Market data fetching

2. **ParadexWebSocketClient** (`src/services/paradex/websocket-client.ts`)
   - Real-time WebSocket connections
   - Live market data streaming (tickers, trades, orderbook)
   - Account updates (positions, orders, fills)
   - Automatic reconnection and subscription management

3. **ParadexTradingAgent** (`src/services/paradex/paradex-agent.ts`)
   - Main trading logic and position management
   - Signal generation and execution
   - Risk management (stop-loss, take-profit)
   - Event-driven architecture with live updates

4. **Live Stream Runner** (`src/strategies/paradex-live-stream.ts`)
   - Standalone application for running the Paradex agent
   - Live console display with real-time updates
   - Event handlers and graceful shutdown

### Event Flow

```
WebSocket ‚Üí Ticker Update ‚Üí Price Cache ‚Üí Position Update ‚Üí Exit Conditions Check
                                                                     ‚Üì
Market Scan ‚Üí Signal Generation ‚Üí Order Execution ‚Üí Position Opened
                                                            ‚Üì
                            Position Monitoring ‚Üê WebSocket Updates
                                    ‚Üì
                        Stop Loss / Take Profit / Max Hold Time
                                    ‚Üì
                            Position Closed ‚Üí Stats Updated
```

## Features

### Real-Time Market Data
- Live ticker updates via WebSocket
- Trade stream for each market
- Orderbook depth updates
- Instant price updates for position monitoring

### Position Management
- Automatic position opening based on signals
- Real-time P&L tracking
- Stop-loss and take-profit execution
- Maximum hold time enforcement
- Trailing stop support

### Risk Management
- Position size limits
- Maximum exposure control
- Daily loss limits
- Maximum concurrent positions
- Leverage management

### Technical Analysis
- Full integration with FlashScalper's technical analysis
- RSI, MACD, Bollinger Bands, Stochastic indicators
- Signal scoring and confidence calculation
- LLM-based analysis (optional)
- Pattern recognition

## Troubleshooting

### Common Issues

#### "Failed to authenticate"
- **Cause**: Invalid JWT token or expired token
- **Solution**: Generate a new JWT token from Paradex API

#### "WebSocket connection failed"
- **Cause**: Network issues or invalid WebSocket URL
- **Solution**: Check your internet connection and verify PARADEX_WS_URL

#### "Insufficient balance"
- **Cause**: Not enough collateral in your account
- **Solution**: Deposit USDC to your Paradex account

#### "Market not found"
- **Cause**: Invalid market symbol in PARADEX_MARKETS
- **Solution**: Use correct market symbols (e.g., "BTC-USD-PERP", not "BTCUSDT")

### Debug Mode

Enable debug logging to see detailed information:

```bash
LOG_LEVEL=debug npm run start:paradex
```

### Testing with Testnet

Always test with Paradex testnet before using mainnet:

```bash
PARADEX_REST_URL=https://api.testnet.paradex.trade/v1
PARADEX_WS_URL=wss://ws.api.testnet.paradex.trade/v1
```

Request testnet funds from the Paradex faucet.

## Security Best Practices

1. **Never commit credentials**: Keep `.env` file out of version control
2. **Use environment variables**: Don't hardcode API keys
3. **Secure private keys**: Store private keys in secure key management systems
4. **Rotate JWT tokens**: Regularly refresh JWT tokens
5. **Test on testnet first**: Always test strategies on testnet
6. **Monitor positions**: Use stop-losses and position limits
7. **Start small**: Begin with small position sizes

## API Reference

### ParadexRestClient

```typescript
const client = new ParadexRestClient(auth, restUrl);

// Account
await client.getAccount();
await client.getBalance();

// Markets
await client.getMarkets();
await client.getTicker('BTC-USD-PERP');

// Positions
await client.getPositions();
await client.getPosition('BTC-USD-PERP');

// Orders
await client.placeMarketOrder('BTC-USD-PERP', 'buy', '0.01');
await client.placeLimitOrder('BTC-USD-PERP', 'buy', '0.01', '42000');
await client.cancelOrder(orderId);
await client.getOpenOrders();
```

### ParadexWebSocketClient

```typescript
const wsClient = new ParadexWebSocketClient(wsUrl, auth, jwt);

// Connect
await wsClient.connect();

// Subscribe
await wsClient.subscribeTicker('BTC-USD-PERP');
await wsClient.subscribePositions();
await wsClient.subscribeOrders();

// Events
wsClient.on('ticker', (ticker) => { /* ... */ });
wsClient.on('positions', (position) => { /* ... */ });
wsClient.on('orders', (order) => { /* ... */ });
```

### ParadexTradingAgent

```typescript
const agent = new ParadexTradingAgent(config);

// Initialize and start
await agent.initialize();
await agent.start();

// Events
agent.on('initialized', () => { /* ... */ });
agent.on('position_update', (position) => { /* ... */ });
agent.on('position_closed', (data) => { /* ... */ });

// Stop
await agent.stop();
```

## Advanced Configuration

### Custom Signal Generation

You can customize signal generation by modifying the `scanMarket` method in `paradex-agent.ts`:

```typescript
private async scanMarket(market: string): Promise<void> {
  // Fetch historical candles
  const candles = await this.fetchCandles(market);
  
  // Generate signal using technical analysis
  const signal = await generateSignal(market, candles, this.state.config);
  
  // Execute if signal qualifies
  if (signal && !signal.rejected) {
    await this.executeSignal(market, signal);
  }
}
```

### Custom Exit Logic

Modify exit conditions in `checkPositionExitConditions`:

```typescript
private checkPositionExitConditions(position: Position): void {
  // Custom exit logic here
  // e.g., time-based exits, trailing stops, etc.
}
```

## Performance Optimization

### WebSocket Reconnection
- Automatic reconnection with exponential backoff
- Resubscription to channels after reconnection
- Ping/pong for connection health monitoring

### Rate Limiting
- Respects API rate limits
- Request queuing and throttling
- Retry logic with backoff

### Memory Management
- Position and order caching
- Efficient market data storage
- Cleanup on disconnect

## Support

For issues and questions:
- **GitHub Issues**: Report bugs and feature requests
- **Documentation**: See [ARCHITECTURE.md](../ARCHITECTURE.md)
- **Paradex Docs**: Visit [docs.paradex.trade](https://docs.paradex.trade/)

## License

MIT License - See [LICENSE](../LICENSE) for details

## Disclaimer

‚ö†Ô∏è **IMPORTANT**: This software is for educational and research purposes only. Trading involves substantial risk of loss. Always test on testnet first and never risk more than you can afford to lose. See [DISCLAIMER.md](../DISCLAIMER.md) for full details.
